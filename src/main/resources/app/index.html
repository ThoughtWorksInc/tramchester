<!DOCTYPE html>
<html lang="en">
<head title="tramchester">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body>
<h1 class="tramchesterHeading w-75">Tramchester</h1>
<div id="journeyplan" class="tramchesterApp">
    <b-form @submit="plan" class="w-75 tramchesterApp">
        <b-container id="startAndEnd">
            <b-row align-h="start">
                <b-col cols="11" class="pl-0">
                    <div id="selectStart">
                        <b-form-select id="fromStop" v-model="startStop" class="mb-3" required>
                            <option :value="null" disabled>Please select start</option>
                            <optgroup v-for="group in proximityGroups" :label="group.name" :name="group.name"
                                      :id="'fromGroup' + group.name">
                                <option class="stop" v-for="stop in filterStops(group)" :value="stop.id">{{stop.name}}
                                </option>
                            </optgroup>
                        </b-form-select>
                    </div>
                </b-col>
                <b-col cols="1"></b-col>
            </b-row>
            <b-row>
                <b-col cols="11" class="pl-0">
                    <div id="selectEnd">
                        <b-form-select id="toStop" v-model="endStop" class="mb-3" required>
                            <option :value="null" disabled>Please select destination</option>
                            <optgroup v-for="group in endProximityGroups" :label="group.name" :name="group.name"
                                      :id="'toGroup' + group.name">
                                <option class="stop" v-for="stop in filterEndStops(group)" :value="stop.id">
                                    {{stop.name}}
                                </option>
                            </optgroup>
                        </b-form-select>
                    </div>
                </b-col>
                <b-col cols="1" class="pl-0">
                    <b-button @click="swap">Swap</b-button>
                </b-col>
            </b-row>
            <b-row>
                <b-col cols="11" class="pl-0">
                    <b-input-group class="mb-3">
                        <b-form-input id="time" v-model="time" type="time" required></b-form-input>
                        <b-input-group-append>
                            <b-button id="nowButton" variant="info" @click="timeToNow()">Now</b-button>
                        </b-input-group-append>
                    </b-input-group>
                </b-col>
            </b-row>
            <b-row>
                <b-col cols="11" class="pl-0">
                    <b-input-group class="mb-3">
                        <b-form-input id="date" v-model="date" type="date" required></b-form-input>
                        <b-input-group-append>
                            <b-button id="todayButton" variant="info" @click="dateToNow()">Today</b-button>
                        </b-input-group-append>
                    </b-input-group>
                </b-col>
            </b-row>
            <b-row align-h="start">
                <b-col cols="2" class="pl-0">
                    <b-button :disabled='!ready' id="plan" type="submit" variant="primary">
                        Plan
                        <b-spinner v-if="searchInProgress" id="spinner" small type="grow"></b-spinner>
                    </b-button>
                </b-col>
                <b-col cols="2">
                    <b-button :disabled='!havePos' id="liveTrams" variant="info" v-if="havePos" @click="queryNearbyTrams">
                        Nearby
                        <b-spinner v-if="liveInProgress" id="nearbySpinner" small type="grow"></b-spinner>
                    </b-button>
                </b-col>
            </b-row>
        </b-container>
    </b-form>

    <div id="networkError" selectable v-if="networkError" class="w-75 tramchesterApp">
        <b-card bg-variant="danger" text-variant="white">
            Unable to commmunicate with server
        </b-card>
    </div>

    <div id="outputs" class="mt-3 ml-1 mr-1">

        <b-card bg-variant="light" border-variant="dark" title="Notes" align="center" v-if="notes.length>0"
                class="mb-2">
            <b-card-text>
                <ul id="NotesList" class="JourneyNotes list-group list-group-flush">
                    <li v-for="note in notes" id="NoteItem">
                        <span v-html="note"></span>
                    </li>
                </ul>
            </b-card-text>
        </b-card>

        <div id="departuesView">
            <b-table id="departures"
                     v-if="localDueTrams.length>0"
                     :current-page="currentPage" sort-icon-left
                     :items="localDueTrams" small responsive="sm"
                     :fields="departureFields" per-page="4"
                     tbody-tr-class='departuresSummary' caption-top>
                <template v-slot:table-caption>
                    <div class="liveDepartures">Live Departures</div>
                </template>
            </b-table>
            <b-pagination v-if="localDueTrams.length>0 && localDueTrams.length>4"
                          v-model="currentPage"
                          :total-rows="localDueTrams.length"
                          per-page="4" align="center"
                          aria-controls="departures"
            ></b-pagination>
        </div>

        <b-table id="results"
                 selectable v-if="journeys.length>0"
                 sort-icon-left
                 :items="journeys" small responsive="sm"
                 :fields="journeyFields"
                 select-mode='single' caption-top
                 @row-clicked="expandStages" tbody-tr-class='journeySummary' caption-top>
            <template v-slot:table-caption>
                <div class="suggestedRoutes">Suggested Routes</div>
            </template>
            <template v-slot:cell(_showDetails)="data">
                <span v-html="data.value">XXX</span>
            </template>
            <template v-slot:row-details="row">
                <b-table :items="row.item.stages" :fields="stageFields"
                         id="stages"
                         tbody-tr-class='stageSummary' small outlined>
                    <template v-slot:cell(actionStation.name)="data">
                        <span v-html="data.value"></span>
                    </template>
                </b-table>
            </template>
        </b-table>
        <div class="container" id="earlierLater" v-if="journeys.length>0">
            <div class="row justify-content-between">
                <b-button id="earlierButton" variant="outline-primary" @click="earlier()">« Earlier</b-button>
                <b-button id="laterButton" variant="outline-primary" @click="later()">Later »</b-button>
            </div>
        </div>
    </div>

    <div id="noResults" selectable v-if="noResults" class="w-75 tramchesterApp">
        <b-card bg-variant="warning">
            No suggested routes were found for this date and time
        </b-card>
    </div>

    <div id="noLiveResults" selectable v-if="noLiveResults" class="w-75 tramchesterApp">
        <b-card bg-variant="light">
            No real time departure information found
        </b-card>
    </div>

    <div id="footer" class="tramchesterFooter mb-1 ml-1 mr-1">
        <b-card bg-variant="light">
            <b-container>
            <b-row>
                <div>
                    Built by <a href="http://www.thoughtworks.com" target="_blank">ThoughtWorks</a> in Manchester
                    <a href="https://twitter.com/intent/user?screen_name=Tramchester" target="_blank">Follow
                        @Tramchester</a>
                </div>
            </b-row>
            <b-row>
                <div id="disclaimer">&copy; 2016-2020 ThoughtWorks Ltd.
                    <b-button id="disclaimerButton"
                              class="align-baseline text-decoration-none tramchesterFooter" variant="link"
                              v-b-modal.modal-disclaimer>Disclaimer
                    </b-button>
                </div>
            </b-row>
           <b-row>
               <div id="license">
                   Contains Transport for Greater Manchester data.
                   Contains public sector information licensed under the Open Government Licence v2.0 by
                   <a href="http://www.datagm.org.uk/" target="_blank">Data GM.</a>
               </div>
           </b-row>
            <b-row align-h="start">
                <b-col cols="3">Build
                    <div id="buildNumber">{{buildNumber}}</div>
                </b-col>
                <b-col cols="3">From:
                    <div id="validFrom">{{feedinfo.validFrom}}</div>
                </b-col>
                <b-col cols="3">Until:
                    <div id="validUntil">{{feedinfo.validUntil}}</div>
                </b-col>
                <b-col cols="3">Geo:
                    <div id="havePos">{{havePos}}</div>
                </b-col>
            </b-row>
            </b-container>
        </b-card>

    </div>

    <b-modal ok-only id="modal-disclaimer" title="Disclaimer">
        <div>
            <p>Whilst every effort has been made to ensure that the contents of this website are correct,
                ThoughtWorks does not guarantee and makes no warranty, express or implied, as to
                the quality, accuracy, completeness, timeliness, appropriateness, or suitability of the
                information we provide on this website.</p>

            <p>ThoughtWorks also takes no responsibility for the accuracy of information contained on
                external sources linked to this site.</p>

            <p>ThoughtWorks assumes no obligation to update the information and the information may
                be changed from time to time without notice.</p>

            <p>To the extent permitted by law ThoughtWorks expressly disclaims all liability for any direct,
                indirect or consequential loss or damage occasioned from the use or inability to use this
                websites, whether directly or indirectly resulting from inaccuracies, defects, viruses, errors -
                whether typographical or otherwise, omissions, out of date information or otherwise.</p>

            <p>Accessing and using the website and the downloading of material from the site (if
                applicable) is done entirely at the user's own risk. The user will be entirely responsible for
                any resulting damage to software or computer systems and/or any resulting loss of data.</p>
        </div>
    </b-modal>

    <b-modal ok-only id="modal-cookieConsent" title="Welcome" ok-title="I Agree"
             @ok="setCookie()" ref="cookieModal" no-close-on-backdrop no-close-on-esc hide-header-close>
        <div id="welcome" class="tramchesterApp w-75">
            <p>Welcome to Tramchester, a quick and easy way to plan your travel in Manchester by Metrolink tram.</p>

            <p>Tramchester uses <b>cookies</b> to store information in your browser about previous usages and recent
                journeys.</p>
        </div>
    </b-modal>

</div> <!-- end of app -->

<script src="/app/dist/main.js"></script>

</body>

</html>
